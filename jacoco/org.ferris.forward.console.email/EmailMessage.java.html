<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>EmailMessage.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ferris-forward</a> &gt; <a href="index.source.html" class="el_package">org.ferris.forward.console.email</a> &gt; <span class="el_source">EmailMessage.java</span></div><h1>EmailMessage.java</h1><pre class="source lang-java linenums">package org.ferris.forward.console.email;

import javax.activation.DataHandler;
import javax.enterprise.context.Dependent;
import javax.mail.Address;
import javax.mail.Flags;
import javax.mail.Message;
import javax.mail.MessagingException;

/**
 *
 * @author Michael Remijan mjremijan@yahoo.com @mjremijan
 */
@Dependent
public class EmailMessage {

    protected Message message;
    
    protected boolean forwarded; 
    
<span class="nc" id="L21">    public EmailMessage(Message m) {</span>
<span class="nc" id="L22">        this.message = m;</span>
<span class="nc" id="L23">        this.forwarded = false;</span>
<span class="nc" id="L24">    }</span>

    public String getSubject() {
        try {
<span class="nc" id="L28">            String subject = message.getSubject();</span>
<span class="nc bnc" id="L29" title="All 2 branches missed.">            if (subject == null) {</span>
<span class="nc" id="L30">                subject = &quot;&quot;;</span>
            }
<span class="nc" id="L32">            return subject;</span>
<span class="nc" id="L33">        } catch (Exception e) {</span>
<span class="nc" id="L34">            throw new RuntimeException(&quot;Problem getting subject&quot;, e);</span>
        }

//        String subject = &quot;&quot;;
//        
//        String[] subjectHeaders 
//            = message.getHeader(&quot;Subject&quot;);
//        
//        if (subjectHeaders == null) {
//            log.warn(&quot;Subject headers array is null&quot;);
//        } 
//        else
//        if (subjectHeaders.length == 0) {
//            log.warn(&quot;Subject headers array is empty&quot;);
//        }
//        else {
//            String subjectHeader = subjectHeaders[0];
//            if (subjectHeader == null) {
//                subjectHeader = &quot;&quot;;
//            }
//            subject = subjectHeader;
//        }
//        log.info(String.format(&quot;Returning subject=\&quot;%s\&quot;&quot;,subject));
//        return subject;
    }

    public Address getFrom() {
        try {
<span class="nc" id="L62">            Address[] froms</span>
<span class="nc" id="L63">                = message.getFrom();</span>
<span class="nc bnc" id="L64" title="All 4 branches missed.">            if (froms == null || froms.length == 0) {</span>
<span class="nc" id="L65">                throw new MessagingException(</span>
                    &quot;The 'froms' array is null or empty so I have no idea who sent the message&quot;
                );
            }
<span class="nc" id="L69">            return froms[0];</span>
<span class="nc" id="L70">        } catch (MessagingException e) {</span>
<span class="nc" id="L71">            throw new RuntimeException(&quot;Problem getting from address&quot;, e);</span>
        }
    }

    public DataHandler getDataHandler() {
        try {
<span class="nc" id="L77">            return message.getDataHandler();</span>
<span class="nc" id="L78">        } catch (MessagingException e) {</span>
<span class="nc" id="L79">            throw new RuntimeException(&quot;Problem getting DataHandler&quot;, e);</span>
        }
    }
    
    public void setForwarded(boolean b) {
<span class="nc" id="L84">        this.forwarded = b;</span>
<span class="nc" id="L85">    }</span>
    
    public boolean isForwarded() {        
<span class="nc" id="L88">        return this.forwarded;</span>
    }
    
    public void expunge() {
        try {
<span class="nc" id="L93">            this.message.setFlag(Flags.Flag.DELETED, true);</span>
<span class="nc" id="L94">        } catch (Exception e) {</span>
<span class="nc" id="L95">            throw new RuntimeException(e.getMessage(),e);</span>
<span class="nc" id="L96">        }</span>
<span class="nc" id="L97">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>